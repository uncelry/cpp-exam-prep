–†–∞–∑–±–µ—Ä—ë–º **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `union` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏** –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ç–∏–ø—ã —á–ª–µ–Ω–æ–≤.

---

# 1Ô∏è‚É£ –ö–æ–≥–¥–∞ `union` —ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å

`union` –ø–æ–ª–µ–∑–µ–Ω, –∫–æ–≥–¥–∞:

- –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å **–æ–¥–Ω–æ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π**
    
- —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è **–≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ**
    
- –≤–∞–∂–Ω–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    

---

# –ü—Ä–∏–º–µ—Ä 1. Variant-–ø–æ–¥–æ–±–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (tagged union)

–ë–µ–∑ `union`:

```cpp
struct BadVariant {
    int i;
    double d;
    char c;
};
```

–†–∞–∑–º–µ—Ä –±—É–¥–µ—Ç:

```
4 + 8 + 1 + padding ‚âà 16‚Äì24 –±–∞–π—Ç–∞
```

–° `union`:

```cpp
struct Variant {
    enum Type { INT, DOUBLE, CHAR } type;

    union {
        int i;
        double d;
        char c;
    };
};
```

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–º–µ—Ä ‚âà

```
sizeof(double) + sizeof(type)
‚âà 8 + 4 = 12 (—Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ 16)
```

üìå –•—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

---

# –ü—Ä–∏–º–µ—Ä 2. –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

```cpp
struct Message {
    enum Kind { Text, Number } kind;

    union {
        int number;
        char text[32];
    };
};
```

–†–∞–∑–º–µ—Ä ‚âà 32 –±–∞–π—Ç–∞, –∞ –Ω–µ 32 + 4.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

- —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞—Ö
    
- embedded-—Å–∏—Å—Ç–µ–º–∞—Ö
    
- –¥—Ä–∞–π–≤–µ—Ä–∞—Ö
    

---

# –ü—Ä–∏–º–µ—Ä 3. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –Ω–∞–±–æ—Ä–∞ –±–∞–π—Ç

```cpp
union IntFloat {
    int i;
    float f;
};
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

- –∞–Ω–∞–ª–∏–∑–∞ –±–∏—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
    
- —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    
- —Ä–∞–±–æ—Ç—ã —Å IEEE 754
    

‚ö† –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º C++ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `std::bit_cast`.

---

# –ü—Ä–∏–º–µ—Ä 4. –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –≤ AST –∏–ª–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–µ

```cpp
struct Node {
    enum Type { IntLiteral, DoubleLiteral } type;

    union {
        int intValue;
        double doubleValue;
    };
};
```

–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∞–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

# 2Ô∏è‚É£ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ç–∏–ø—ã —á–ª–µ–Ω–æ–≤ union

## üîπ 1. –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π —á–ª–µ–Ω

–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ¬´–∂–∏–≤—ã–º¬ª –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç.

---

## üîπ 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏

–ï—Å–ª–∏ –≤ union –µ—Å—Ç—å:

- –∫–ª–∞—Å—Å —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º
    
- –∫–ª–∞—Å—Å —Å –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º
    
- –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    

—Ç–æ:

- –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä/–¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä
    
- –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ –≤—Ä—É—á–Ω—É—é
    

---

### –ü—Ä–∏–º–µ—Ä

```cpp
union U {
    std::string s;
    int i;
};
```

–¢–∞–∫ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```cpp
U u;
new (&u.s) std::string("Hello");
u.s.~basic_string();
```

---

## üîπ 3. –ù–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–æ—á–Ω—ã–µ —Ç–∏–ø—ã

```cpp
union U {
    int& ref; // ‚ùå –∑–∞–ø—Ä–µ—â–µ–Ω–æ
};
```

---

## üîπ 4. –ù–µ–ª—å–∑—è –∏–º–µ—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ union

Union –Ω–µ –º–æ–∂–µ—Ç:

- –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è
    
- –∏–º–µ—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    
- –∏–º–µ—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
    

---

## üîπ 5. –°—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ aliasing

–ß—Ç–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–ª–µ–Ω–∞ ‚Üí **Undefined Behavior**.

–ü—Ä–∏–º–µ—Ä:

```cpp
u.i = 10;
std::cout << u.f; // UB
```

---

# 3Ô∏è‚É£ –†–∞–∑–º–µ—Ä union –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ

–†–∞–∑–º–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è:

```
max(sizeof(member)) + –≤–æ–∑–º–æ–∂–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
```

–ü—Ä–∏–º–µ—Ä:

```cpp
union U {
    char c;      // 1
    double d;    // 8
};
```

–†–∞–∑–º–µ—Ä –±—É–¥–µ—Ç 8, –Ω–µ 9.

---

# 4Ô∏è‚É£ –ö–æ–≥–¥–∞ union –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω

‚úî Embedded-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞  
‚úî –ò–≥—Ä–æ–≤—ã–µ –¥–≤–∏–∂–∫–∏  
‚úî –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã  
‚úî –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã  
‚úî –ö–æ–≥–¥–∞ –≤–∞–∂–µ–Ω —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

# 5Ô∏è‚É£ –ö–æ–≥–¥–∞ –ù–ï —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

‚ùå –í –æ–±—ã—á–Ω–æ–º –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–º –∫–æ–¥–µ  
‚ùå –ï—Å–ª–∏ –Ω–µ—Ç —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∞–∫—Ç–∏–≤–Ω—ã–º —á–ª–µ–Ω–æ–º  
‚ùå –ï—Å–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `std::variant`

---

# 6Ô∏è‚É£ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞

```cpp
std::variant<int, double, char>
```

–ü–ª—é—Å—ã:

- –±–µ–∑–æ–ø–∞—Å–Ω–æ
    
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
    
- –∏—Å–∫–ª—é—á–∞–µ—Ç UB
    

---

# –ò—Ç–æ–≥

### union –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

- —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    
- —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
    
- –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–π—Ç–∞–º–∏
    

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

- –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π —á–ª–µ–Ω
    
- —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
    
- –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫–∏
    
- —á—Ç–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–ª–µ–Ω–∞ = UB
    
- –Ω–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
    
